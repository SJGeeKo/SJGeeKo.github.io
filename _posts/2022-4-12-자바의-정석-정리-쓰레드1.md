---
layout: post
title: 자바의 정석 정리 - 쓰레드
---

# 프로세스와 쓰레드
- 프로세스: 실행중인 프로그램.
    - 데이터(프로그램 실행에 필요한) + 자원(메모리 등) + 쓰레드로 구성
    - 동작순서: 사용자가 프로그램 실행 -> OS로부터 실행에 필요한 자원(메모리) 할당 -> 프로세스 생성
- 쓰레드: 프로세스의 자원을 이용해서 실제로 작업을 수행하는 친구
    - 프로세스는 공장, 쓰레드는 일꾼 비유로 이해하자
    - 프로세스당 쓰레드가 최소 하나 존재(하나면 싱글쓰레드, 둘 이상이면 멀티쓰레드)
## 멀티쓰레딩
- 멀티태스킹: 여러 개의 프로세스가 동시에 실행되는 것
- 멀티쓰레딩: 하나의 프로세스 내에서 여러 쓰레드가 동시에 작업을 수행하는 것
    - 실제로는 CPU 코어 1개당 1개의 작업 밖에 못함 -> 8코어다? 한 번에 8개 작업이 최대.
    - 그럼에도 훨씬 많은 쓰레드가 동작할 수 있는 이유 -> 코어 1개가 짧은 시간에 이리갔다 저리갔다 함.
    - 그래서 멀티쓰레딩이 싱글쓰레딩보다 느린 경우 종종 있음
- 왜씀?
    - 예: 메신저로 채팅하면서 파일 다운 받기.
        - 만약 멀티쓰레딩 없었다면 파일 다운 받는 동안 메시지 못 받고 못 보냄.
        - 멀티쓰레딩 쓴다? 파일 잠깐 받고 메시지 잠깐 보내고 다시 파일 받고 다시 메시지 잠깐 보내고... -> 워낙 짧은 시간이라 사용자는 동시에 된다고 생각
    - 만능은 아님 - 동기화, 교착상태 등 멀티쓰레딩으로 인해 생길 수 있는 문제들이 있다.

# 쓰레드의 구현과 실행
- 방법 1: Thread 클래스 상속받기
    ```java
    class MyThread extends Thread {
        public void run() { /* 작업내용 */ } // Thread클래스의 run()을 오버라이딩
    }
    ```
    - 자바는 다중상속 안돼서 이 방법 쓰면 다른 거 상속 못받음.
- **방법 2(추천)**: Runnable 인터페이스 구현하기
    ```java
    class MyThread implements Runnable {
        public void run() { /* 작업내용 */ } // Runable 인터페이스의 run()을 구현
    }
    ```
    - 실행
    ```java
    Runnable r = new MyRunnable(); // Runnable 인터페이스 구현체
    thread t1 = new Thread(r);
    
    t1.start(); // MyRunnable의 run 메서드 실행
    ```
    - 현재 실행중인 Thread를 반환받고 싶으면 Thread 클래스의 static method를 사용해서 ```Thread.currentThread()```로 호출해야 함.
    - Thread 인스턴스 생성시 두 번째 인자로 Thread 이름 설정 가능
## 쓰레드 실행
- ```.start()```하면 됨.
- 한 번 실행한 쓰레드를 다시 실행할 순 없음. 굳이 하고싶다면 쓰레드 다시 생성 ㄱㄱ
### 동작방식
- 순서: 독립적인 호출 스택 생성 -> ```run()```이 첫 번째 스택으로 올라감 -> 쓰레드 실행 -> 쓰레드 종료 -> 호출스택 소멸
- 기본적으로 main 쓰레드가 있다
- ```.start()```로 인해 새로운 호출스택이 하나 생기게 되면 main 쓰레드와 새롭게 생성된 쓰레드의 작업이 번갈아 진행됨
    - 하나가 실행중일 때 다른 하나는 **실행대기** 상태
    - 번갈아 진행되는 것에 대한 우선순위는 생성시 지정 가능
- 한 쓰레드에 예외가 발생해서 종료돼도 다른 쓰레드는 영향 받지 않음.