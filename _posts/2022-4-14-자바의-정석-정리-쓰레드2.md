---
layout: post
title: 자바의 정석 정리 - 쓰레드2
---

# 싱글쓰레드와 멀티쓰레드

- 멀티쓰레드 특징: 한 번에 여러가지 일 할 수 있으나 싱글쓰레드보다 느린 경우 있음(작업간 스위칭 코스트 때문)
- 서로 다른 자원을 사용하는 다수의 쓰레드가 있다면 멀티쓰레드 프로세스가 효율적
    - ex: 사용자로부터 데이터를 입력받는 작업. 싱글쓰레드라면 입력 받을 때까지 아무 것도 못함.

# 쓰레드의 우선순위

- 쓰레드는 우선순위라는 속성(멤버변수)을 갖고 있음
- 이에 따라 각 쓰레드가 점유하는 시간 길이가 달라짐
    - 중요도가 높은 것 or 반응성이 높아야 하는 것은 우선순위 올려야.
- 기본적으로 우선순위는 **쓰레드를 생성한 쓰레드로부터 상속**받음
- 멀티코어의 경우 쓰레드의 우선순의가 거의 의미 없음(실제로 둘이 동시에 작업하므로)

# 쓰레드 그룹

- 서로 관련된 쓰레드를 그룹으로 다루기 위한 개념(폴더라고 생각하자)
- 자신이 속한 쓰레드 그룹 or 하위 쓰레드 그룹 변경 가능, 다른 쓰레드 그룹은 변경 X
- 모든 쓰레드는 반드시 쓰레드 그룹에 포함돼있어야 함. 설정 안하면 생성한 쓰레드 그룹 하위로 들어감.

# 데몬 쓰레드

- 일반 쓰레드의 작업을 돕는 보조 쓰레드(가비지 컬렉터, 자동저장, 화면갱신...)
- 일반 쓰레드와 작성방법, 실행방법 같음. 단, 실행하기 전에 ```setDaemon(true)```를 호출해야 함.
- 무한루프 + 조건문을 이용, 특정 조건이 만족되면 수행하고 대기하도록 작성
    - 기본적으로 무한루프니 ```setDaemon(true)```가 없다면 영원히 종료되지 않을 것.
# 쓰레드의 실행제어

## 스케줄링 관련 메서드

|메서드|설명|
|--|--|
|```sleep()```|지정된 시간동안 쓰레드 일시정지. 시간 다 지나면 실행대기 상태|
|```join()```|지정된 시간동안 쓰레드 실행. 지정된 시간이 지나거나 작업 끝나면 호출한 쓰레드로 복귀|
|```interrupt()```|일시정지상태 → 실행대기상태. InterruptedException 발생함|
|```stop()```|쓰레드 종료시킴|
|```suspend()```|일시정지|
|```resume()```|suspend()로 일시정지된 쓰레드를 실행대기상태로 바꿈|
|```yield()```|자신에게 주어진 실행시간을 다른 쓰레드에게 양보 후 자신은 실행대기상태로|

## 쓰레드의 상태

|상태|설명|
|--|--|
|NEW|쓰레드 생성되고 아직 start()가 호출되지 않은 상태|
|RUNNABLE|실행중 or 실행 가능|
|BLOCKED|동기화 블럭에 의해서 일시정지된 상태|
|WAITING, TIMED_WAITING|쓰레드의 작업이 종료되진 않았지만 실행가능하지 않은 일시정지 상태. TIMED_WAITING은 일시정지시간이 지정된 경우를 의미함.
|TERMINATED|쓰레드의 작업 종료|

### ```sleep(long millis)```
- 쓰레드 일시정지 시키는 메서드.
- ```Thread.sleep(1000);``` 이런 식으로 사용.
- 일시정지 언제 풀리나? 지정된 시간 다 되거나, ```interrupt()``` 호출된 경우
    - `ìnterrupt()`가 호출되면 InterruptedException이 발생하게 되므로 항상 try-catch로 감싸줘야 함.
    - 이게 귀찮다? 아래와 같이 미리 try-catch로 묶어둔 메서드를 따로 정의하기도 함.
    ```java
    void delay(long millis) {
        try {
            Tread.sleep(millis);
        } catch(InterruptedException e) {}
    }
    ```
- 주의
    ```java
    public static void main(String[] args) {
        MyThread th1 = new MyThread(); // MyThread라는 클래스 정의했다고 치자
        th1.sleep(1000); // 이러면 안됨
    }
    ```
    - `.sleep()`은 항상 현재 실행중인 쓰레드에 대해 작동함. 즉, 위의 경우 main 쓰레드가 sleep함.
    - 따라서 `.sleep()`이 스태틱메서드임을 이용하여 `Thread.sleep(1000)` 이런 식으로 쓰는 것이 적절.